<!DOCTYPE html>
<html ⚡>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.15-DEV" />

    <link href="https://fonts.googleapis.com/css?family=Lora:400,700" rel="stylesheet" type="text/css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://yet.unresolved.xyz/index.xml">

    
    
    

    <title>AMP対応をした - Unresolved</title>

    <link rel="canonical" href="https://yet.unresolved.xyz/blog/2016/03/08/accelerated-mobile-pages/">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <meta name="theme-color" content="#2196f3">

    
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "mainEntityOfPage":{
          "@type":"WebPage",
          "@id":"https:\/\/yet.unresolved.xyz\/"
        },
        "headline": "AMP対応をした - Unresolved",
        "image": {
          "@type": "ImageObject",
          "url": "https:\/\/yet.unresolved.xyz\/images/logo.png",
          "height": 700,
          "width": 700
        },
        "datePublished": "2016-03-08T15:25:13JST",
        "dateModified": "2016-03-08T15:25:13JST",
        "author": {
          "@type": "Person",
          "name": "Daisuke Tsuji",
          "image": "https:\/\/yet.unresolved.xyz\/images/logo.png"
        },
        "publisher": {
          "@type": "Organization",
          "name": "Daisuke Tsuji",
          "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/yet.unresolved.xyz\/images/logo.png",
            "height": 60,
            "width": 60
          }
        },
        "description": "巷で話題のAMP対応をしました。 僕のブログはこの規模なので、別ページとして作るのではなく純粋にページ自体を作り変えました。 AMP？ Accelerated Mobile Pages Project For"
      }
    </script>
    

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>

    <style amp-custom>
 
html {
  font-size: 18px;
}

@media (max-width: 768px) {
  html {
    font-size: 16px;
  }
}

body {
  font-family: "Lora", "游明朝", YuMincho, "ヒラギノ明朝 ProN W3", "Hiragino Mincho ProN", "HG明朝E", "ＭＳ Ｐ明朝", "ＭＳ 明朝", serif;
  font-size: inherit;
  color: #333;
}

html,
body {
  margin: 0;
}

p {
  margin: 0;
}

a {
  color: #03a9f4;
  text-decoration: none;
  transition-duration: .2s;
}

a:hover,
a:focus,
a:active {
  color: #2196f3;
  text-decoration: underline;
}

ul, ol {
  margin: 0;
  padding: 0;
}

h1, h2, h3, h4, h5 ,h6 {
  margin: 0;
  font-size: 1rem;
  word-break: break-all;
  font-weight: normal;
  color: #000;
}

 
.container {
  max-width: 40rem;
  margin: 0 auto;
  padding: 0 .5rem;
}

 
.l-header {
  position: relative;
  text-align: center;
  padding: 3rem 0;
  margin-bottom: 4rem;
}

.l-header::before,
.l-header::after {
  position: absolute;
  top: -3rem;
  right: -3rem;
  left: -3rem;
  content: '';
  display: block;
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
}

.l-header::before {
  transform: rotate(-1deg);
  bottom: 0;
  z-index: -1;
  background-color: #263238;
}

.l-header::after {
  transform: rotate(-2deg);
  bottom: -.5rem;
  z-index: -2;
  background-color: #03A9F4;
}

.l-footer {
  font-size: .8rem;
  padding: 1rem 0;
}

 
.p-error {
  padding: 2rem 0;
}

 
.p-logo {
  text-align: center;
  margin-bottom: 1rem;
}

.p-logo a {
  font-weight: 700;
  font-size: 1.6rem;
  line-height: 2rem;
  color: #fff;
  text-transform: uppercase;
}

.p-logo a::before,
.p-logo a::after {
  display: inline-block;
  content: '';
  height: 2rem;
}

.p-logo a::before {
  vertical-align: 0;
}

.p-logo a::after {
  vertical-align: -1rem;
}

 
.p-sections a {
  display: inline-block;
  font-size: .7rem;
  line-height: 1.5rem;
  font-weight: 700;
  text-transform: uppercase;
  color: #fff;
}

 
.p-tags a {
  color: #333;
  font-size: .8rem;
  text-decoration: underline;
}

 
ul.h-inline, ol.h-inline {
  list-style: none;
}

.h-inline li {
  display: inline-block;
  margin: 0 .25rem;
}

 
article.single {
  margin-bottom: 2rem;
}

article.li {
  margin-bottom: 2rem;
}

article.li>a {
  display: block;
}

article.li>a:hover {
  text-decoration: none;
}

article .detail {
  color: #999;
  font-size: .7rem;
  font-weight: 700;
  line-height: 1rem;
}

article .title {
  font-weight: 700;
  word-break: break-all;
  color: #000;
  margin: .5rem 0;
  font-size: 1.2rem;
  line-height: 1.5rem;
}

article.single .title {
  font-size: 1.4rem;
  line-height: 2rem;
}

article .summary {
  color: #999;
  font-size: .8rem;
  word-break: break-all;
  line-height: 1rem;
}

article .body {
  margin-bottom: 2rem;
}

article .body a {
  text-decoration: underline;
}

article .body p {
  line-height: 1.5rem;
  margin: 1.5rem 0;
  word-break: break-all;
}

article .body h1,
article .body h2,
article .body h3,
article .body h4,
article .body h5,
article .body h6 {
  font-weight: 700;
}

article .body h1:first-child,
article .body h2:first-child,
article .body h3:first-child,
article .body h4:first-child,
article .body h5:first-child,
article .body h6:first-child {
  margin-top: 0;
}

article .body h1,
article .body h2 {
  margin-top: 4rem;
  padding: .5rem 0;
  line-height: 1.5rem;
  font-size: 1.2rem;
}

article .body h3 {
  margin-top: 1.5rem;
}

article .body h4 {
  margin-top: 1rem;
  text-decoration: underline;
}

article .body blockquote {
  font-size: .8rem;
  padding: .5rem;
  border-left: none;
  margin: .5rem 0;
  background-color: #eceff1;
}

article .body blockquote p {
  line-height: 1rem;
  margin: 0;
}

article .body blockquote ul,
article .body blockquote ol {
  margin: 0;
  padding: 0;
  padding-left: 1.5rem;
}

article .body ul,
article .body ol {
  padding-left: 1.5rem;
  margin: 0;
  line-height: 1.5rem;
}

article .body amp-img {
  max-width: 100%;
  box-shadow: 0 0 0 .25rem #eceff1;
  margin: 1rem 0;
}

article .body pre {
  padding: .5rem;
  margin: 2rem 0;
  border: none;
  border-radius: 0;
  font-size: .8rem;
  line-height: 1rem;
  overflow: auto;
  background-color: #333;
  color: #fff;
  text-shadow: 1px 1px 0 #000;
}

article .body p code,
article .body li code {
  padding: .25rem;
  margin: 0 .25rem;
  font-size: .8rem;
  white-space: nowrap;
  line-height: 1rem;
  background-color: #eee;
}

.page-title {
  margin-bottom: 1rem;
}

nav.page {
  position: relative;
  margin-bottom: 2rem;
  min-height: 3rem;
}

nav.page a {
  position: absolute;
  display: inline-block;
  font-size: .8rem;
  font-weight: 700;
  line-height: 3rem;
  padding: 0 2rem;
  box-shadow: 0 0 0 1px #eee;
  color: #999;
}

nav.page a.next {
  right: 0;
}
</style>


  </head>

  <body>
    <amp-analytics type="googleanalytics" id="analytics1">
      <script type="application/json">
        {
          "vars": {
            "account": "UA-55005303-1"
          },
          "triggers": {
            "trackPageview": {
              "on": "visible",
              "request": "pageview"
            }
          }
        }
      </script>
    </amp-analytics>

    <header class="l-header">

      <div class="p-logo">
        <a href="https://yet.unresolved.xyz/">Unresolved</a>
      </div>

      <ul class="h-inline p-sections">
        
        
        <li><a href="https://yet.unresolved.xyz//book">book</a></li>
        
        
        
        <li><a href="https://yet.unresolved.xyz//diary">diary</a></li>
        
        
        
        <li><a href="https://yet.unresolved.xyz//technology">technology</a></li>
        
        
      </ul>

    </header>

    <div class="container">


<article class="single">

  <header>
    <h1 class="title">AMP対応をした</h1>
    <div class="detail">
      <time class="date">Tue, Mar 8, 2016</time> - <a href="https://yet.unresolved.xyz/technology" class="section">technology</a>
    </div>
  </header>

  <div class="body">

<p>巷で話題のAMP対応をしました。
僕のブログはこの規模なので、別ページとして作るのではなく純粋にページ自体を作り変えました。</p>

<h2 id="amp:248155386e4621d756694486f44e789c">AMP？</h2>

<p><a href="https://www.ampproject.org/">Accelerated Mobile Pages Project</a></p>

<blockquote>
<p>For many, reading on the mobile web is a slow, clunky and frustrating experience - but it doesn’t have to be that way. The Accelerated Mobile Pages (AMP) Project is an open source initiative that embodies the vision that publishers can create mobile optimized content once and have it load instantly everywhere.</p>
</blockquote>

<p>モバイル用に爆速な感じのページを作ろうぜってやつですね。
そのためにHTMLをゴリゴリ書き換えなければいけないです。</p>

<p>いろいろなサイトを見てると、AMP対応のために別ページを用意して<code>rel</code>を張るパターンが多いようでした。</p>

<p><a href="https://www.ampproject.org/docs/guides/discovery.html#linking-pages-with-ltlinkgt">Make Your Page Discoverable</a></p>

<pre><code class="language-html">&lt;link rel=&quot;amphtml&quot; href=&quot;https://www.example.com/url/to/amp/document.html&quot;&gt;
</code></pre>

<p>実際対応してみた感想としては、この対応が一番理想的だと思っています。</p>

<h2 id="始め方:248155386e4621d756694486f44e789c">始め方</h2>

<p>ドキュメントはかなり整理されているので、特に詰まることなく実装は出来ると思います。</p>

<p>このページにある通り、必須の項目を<code>head</code>タグ内に入れたりするだけで始められます。</p>

<p><a href="https://www.ampproject.org/docs/get_started/create/basic_markup.html">Create Your AMP HTML Page</a></p>

<pre><code class="language-html">&lt;!doctype html&gt;
&lt;html amp lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Hello, AMPs&lt;/title&gt;
    &lt;link rel=&quot;canonical&quot; href=&quot;http://example.ampproject.org/article-metadata.html&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,minimum-scale=1,initial-scale=1&quot;&gt;
    &lt;script type=&quot;application/ld+json&quot;&gt;
      {
        &quot;@context&quot;: &quot;http://schema.org&quot;,
        &quot;@type&quot;: &quot;NewsArticle&quot;,
        &quot;headline&quot;: &quot;Open-source framework for publishing content&quot;,
        &quot;datePublished&quot;: &quot;2015-10-07T12:02:41Z&quot;,
        &quot;image&quot;: [
          &quot;logo.jpg&quot;
        ]
      }
    &lt;/script&gt;
    &lt;style amp-boilerplate&gt;body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}&lt;/style&gt;&lt;noscript&gt;&lt;style amp-boilerplate&gt;body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}&lt;/style&gt;&lt;/noscript&gt;
    &lt;script async src=&quot;https://cdn.ampproject.org/v0.js&quot;&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Welcome to the mobile web&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p><code>&lt;html&gt;</code>に<code>amp</code>もしくは「⚡」を入れることでAMP対応を明示するようです。
せっかくなので、このブログは絵文字で対応しました。</p>

<h2 id="imgタグの置き換え:248155386e4621d756694486f44e789c">IMGタグの置き換え</h2>

<p>基本的にAMPは機能拡張ではなく制限なので、既存のHTMLの置き換えや削除で対応出来ます。
まず最初に説明されているのは画像の表示について。</p>

<pre><code class="language-html">&lt;amp-img src=&quot;welcome.jpg&quot; alt=&quot;Welcome&quot; height=&quot;400&quot; width=&quot;800&quot;&gt;&lt;/amp-img&gt;
</code></pre>

<p>AMP用のタグが用意されているので、それに置き換える必要があります。
<code>layout</code>などの属性も用意されているので、少しだけ融通は効くようです。<code>width</code>と<code>height</code>は必須のようでした。きついですね。</p>

<p><a href="https://www.ampproject.org/docs/guides/amp_replacements.html#include-an-image">Include Iframes and Media#include-an-image</a></p>

<p>サイズを指定しなくても横幅に応じて良きに計らってほしいのですが、僕はその記述をドキュメントから見つけられませんでした。</p>

<h2 id="スタイルの定義:248155386e4621d756694486f44e789c">スタイルの定義</h2>

<p>スタイルシートは<code>&lt;head&gt;</code>内にベタで置くことになっているようです。</p>

<pre><code class="language-html">&lt;style amp-custom&gt;
  /* any custom style goes here */
  body {
    background-color: white;
  }
  amp-img {
    background-color: gray;
    border: 1px solid black;
  }
&lt;/style&gt;
</code></pre>

<p>この<code>&lt;style amp-custom&gt;</code>タグは1ページに1個までとの制約があったり、<code>:not()</code>など、禁止されている機能もあるようです。</p>

<p><a href="https://www.ampproject.org/docs/guides/responsive/style_pages.html#disallowed-styles">How to Style Your Pages#disallowed-styles</a></p>

<p>外部スタイルシートは原則<strong>フォント読み込みのみ可</strong>、とのことです。Google Fontsなどですね。</p>

<p>BootstrapやSkeletonなどのCSSフレームワークはどうしたらいいんだろうと思ったのですが、
そもそもAMPの目的を考えると、CSSフレームワークが必要なほどのデザインを施すこと自体が間違っているのかもしれません。</p>

<p>僕は今回の対応で3rdパーティ系のライブラリはすべて撤去しました。（<code>.container</code>とグリッドシステムくらいしか使っていなかったので、そもそも不要でした。）</p>

<h2 id="javascriptの排除:248155386e4621d756694486f44e789c">JavaScriptの排除</h2>

<p>原則禁止のようです。
Google Analytics等は専用の記述が用意されていました。こういった例外的な扱いが他にもいくつかあるようです。</p>

<p><a href="https://developers.google.com/analytics/devguides/collection/amp-analytics/">Adding Analytics to your AMP pages  |  Analytics for AMP Pages  |  Google Developers</a></p>

<p>このブログではコードハイライトのために<a href="https://highlightjs.org/">highlight.js</a>を使っていたのですが、それもこの対応で外しました。</p>

<h2 id="バリデーション:248155386e4621d756694486f44e789c">バリデーション</h2>

<p>当該ページのURL末尾に<code>#development=1</code>をつけてChromeでアクセスすれば、Chrome DevTools consoleにバリデーション結果が表示されるようになっています。</p>

<p><a href="https://www.ampproject.org/docs/guides/validate.html">Validate AMP Pages</a></p>

<p>個々のエラーメッセージに応じた対応方法なども記載されているので、やはりドキュメントは充実していますね。</p>

<h2 id="終わりに:248155386e4621d756694486f44e789c">終わりに</h2>

<p>JS禁止などを見てもわかるように、やはりAMPはAMP用のページを別で作るのが理想的な気がします。
会社で運営しているサイトも対応をしたいのですが、あまりコストの低い作業でもないので一旦保留にしています。</p>

<p>Google Search Console等でもAMP対応の状況が表示されるようになっているので、おそらくAMPはこのまま普及していくのではないかと思っています。</p>

<p>仕様も今後変わっていくと思うので、その辺も追う元気があれば対応していきたいと思います。</p>
</div>

  <aside>
    <ul class="h-inine p-tags">
      
      <a href="https://yet.unresolved.xyz/tags/amp">amp</a>
      
      <a href="https://yet.unresolved.xyz/tags/google">google</a>
      
    </ul>
  </aside>

</article>

      <footer class="l-footer">
        <p>&copy; 2016 Daisuke Tsuji</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank" rel="nofollow">Hugo</a>, Theme <a href="https://github.com/dim0627/hugo_theme_harb" target="_blank" rel="nofollow">Harb</a> designed by <a href="http://yet.unresolved.xyz" target="_blank" rel="nofollow">Daisuke Tsuji</a></p>
      </footer>

    </div>
  </body>
</html>


