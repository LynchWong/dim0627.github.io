<div class="single">
  <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.15-DEV" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Open+Sans|Lobster'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/custom.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://yet.unresolved.xyz//index.xml">

    
    <title>ブログをOctopressからHugoに移行した - Unresolved</title>
    <meta property='og:title' content="ブログをOctopressからHugoに移行した - Unresolved">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="http://yet.unresolved.xyz/blog/2015/01/04/migrate-blog-to-hugo-from-octopress/">
    
    

  </head>

  <body>

    <div class="container-fluid">
      <header class="site">
        <div class="title"><a href="http://yet.unresolved.xyz/">Unresolved</a></div>
      </header>
    </div>

    <div class="container site">


  <article class="single" itemscope="itemscope" itemtype="http://schema.org/Article">

    <meta itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" content="http://yet.unresolved.xyz/"/>
    <meta itemprop="dateModified" content="2015-01-04T00:00:00&#43;00:00">
    <meta itemprop="headline" content="ブログをOctopressからHugoに移行した">
    <meta itemprop="description" content="Octopressでのブログもずいぶん慣れてきたところでHugoに移行しました。 一晩徹夜して、カスタマイズからGitHub Pagesでの公開">
    <meta itemprop="url" content="http://yet.unresolved.xyz/blog/2015/01/04/migrate-blog-to-hugo-from-octopress/">
    <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
      <meta itemprop="url" content="http://yet.unresolved.xyz/images/default.jpg" />
      <meta itemprop="width" content="800">
      <meta itemprop="height" content="800">
    </div>
    <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
      <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
        <meta itemprop="url" content="http://yet.unresolved.xyz/images/logo.jpg">
        <meta itemprop="width" content="100">
        <meta itemprop="height" content="100">
      </div>
      <meta itemprop="name" content="Unresolved">
    </div>
    <div itemprop="author" itemscope itemtype="https://schema.org/Person">
      <meta itemprop="name" content="Daisuke Tsuji">
    </div>

    <header>

      <div class="clearfix">

        <div class="image" style="background-image: url(http://yet.unresolved.xyz/images/default.jpg);"></div>
        <div class="detail">
          <time itemprop="datePublished" pubdate="pubdate" datetime="2015-01-04T00:00:00&#43;00:00">Sun, Jan 4, 2015</time>
          
          <h1 class="title">ブログをOctopressからHugoに移行した</h1>
        </div>
      </div>

      <div class="share">
        <a href="http://www.facebook.com/sharer.php?src=bm&u=http%3a%2f%2fyet.unresolved.xyz%2fblog%2f2015%2f01%2f04%2fmigrate-blog-to-hugo-from-octopress%2f&t=%e3%83%96%e3%83%ad%e3%82%b0%e3%82%92Octopress%e3%81%8b%e3%82%89Hugo%e3%81%ab%e7%a7%bb%e8%a1%8c%e3%81%97%e3%81%9f" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-facebook"></i></a>
        <a href="http://twitter.com/intent/tweet?url=http%3a%2f%2fyet.unresolved.xyz%2fblog%2f2015%2f01%2f04%2fmigrate-blog-to-hugo-from-octopress%2f&text=%e3%83%96%e3%83%ad%e3%82%b0%e3%82%92Octopress%e3%81%8b%e3%82%89Hugo%e3%81%ab%e7%a7%bb%e8%a1%8c%e3%81%97%e3%81%9f&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
        <a href="https://plus.google.com/share?url=http%3a%2f%2fyet.unresolved.xyz%2fblog%2f2015%2f01%2f04%2fmigrate-blog-to-hugo-from-octopress%2f" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-google-plus"></i></a>
        <a href="http://getpocket.com/edit?url=http%3a%2f%2fyet.unresolved.xyz%2fblog%2f2015%2f01%2f04%2fmigrate-blog-to-hugo-from-octopress%2f&title=%e3%83%96%e3%83%ad%e3%82%b0%e3%82%92Octopress%e3%81%8b%e3%82%89Hugo%e3%81%ab%e7%a7%bb%e8%a1%8c%e3%81%97%e3%81%9f" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-get-pocket"></i></a>
      </div>

    </header>

    <div class="article-body" itemprop="articleBody">

<p><a href="http://octopress.org/">Octopress</a>でのブログもずいぶん慣れてきたところで<a href="http://gohugo.io/">Hugo</a>に移行しました。</p>

<p>一晩徹夜して、カスタマイズからGitHub Pagesでの公開までいけたのでいろいろまとめてみる。</p>

<h2 id="なぜ移行:6a8fd8223fd13a59d819b0862af33f03">なぜ移行？</h2>

<p>ずっとテーマのカスタマイズをしたいと思ってたんだけど、Octopressのテーマの構成がいつまでたっても理解出来なかったのが一番の理由。
テーマというか、テンプレートの構成かな・・・。</p>

<p>Google Adsenseとかも導入したんだけど、そんな些細な修正ですらちょっと辛い感じになってしまってたので、いっそ土台ごと変えることに。</p>

<h2 id="hugoに移行するメリット:6a8fd8223fd13a59d819b0862af33f03">Hugoに移行するメリット</h2>

<p>せっかくだし移行してみてよかったことをまとめてみます。</p>

<h3 id="速い:6a8fd8223fd13a59d819b0862af33f03">速い</h3>

<p>何をするにも動作がめちゃくちゃ速い。</p>

<p>記事数がそんなに多くないからOctopressでも不満はなかったんだけど、今考えればとてつもない遅さだったなあと思う。</p>

<p>Hugoはほんとに一瞬で記事を生成するし、サーバの起動も一瞬なのでライブリロードがいらないくらい。使ってるけど。</p>

<h3 id="構造がシンプル:6a8fd8223fd13a59d819b0862af33f03">構造がシンプル</h3>

<p>トップページ、記事一覧、記事個別のページ、って感じで綺麗に区分けがされてる。
ルールがすごく綺麗に作られてるから、テーマの理解も楽だし、カスタマイズもしやすいなと思った。</p>

<p>あと、カテゴリとかタグみたいに、記事間を横断的に集計したい場合もすごく簡単に出来る。</p>

<p><a href="http://gohugo.io/taxonomies/overview/">Taxonomy Overview</a></p>

<h3 id="無駄な物がない:6a8fd8223fd13a59d819b0862af33f03">無駄な物がない</h3>

<p>Hugoは<code>new</code>で作った時に基礎になるテンプレートがないくらい、標準装備が少ない。</p>

<p>まあそれじゃテスト実行さえ出来ないからどうなんだっていう人もいると思うけど。
僕は結構0から作りたい方なので、これくらいすっきりさせてくれてたほうが嬉しかった。</p>

<h2 id="移行によるデメリット:6a8fd8223fd13a59d819b0862af33f03">移行によるデメリット</h2>

<p>とはいえ全てがよかったわけではなくて、途中で何度か引き返そうと思う場面もあったので、そこも書いとく。</p>

<h3 id="自分でやらなきゃいけないことが多い:6a8fd8223fd13a59d819b0862af33f03">自分でやらなきゃいけないことが多い</h3>

<p>やっぱりOctopressはRakeタスクでかなり囲い込みが出来てたなあと思う。</p>

<p>OctopressをGitHub Pagesで公開する場合、masterとsourceブランチが作成されるんだけど、あれは運用面でも非常に楽だった。</p>

<p>Hugoはデプロイは一切触れずに、本当に静的な資材の生成しかしないから、その辺は自分でやらなきゃいけない。
だから初めての人には辛いところがあるかも。</p>

<p>あ、あとDISQUSとかもテーマによってはIDを指定するだけで使えたり、自分でタグを埋め込まなきゃ使えなかったりする。
記事のカテゴリ分けとかタグ付けについても自分で設定しなきゃいけない。公式に手順はあるけど。</p>

<h3 id="日本語タイトルが使いづらい:6a8fd8223fd13a59d819b0862af33f03">日本語タイトルが使いづらい</h3>

<p>Octopressの時は、記事のMarkdownファイルのファイル名は英語にして、ファイル内のtitleで日本語を設定してました。</p>

<p>Hugoはデフォルトだとファイル内のtitleで記事個別ページのURLを生成するから、マルチバイトが入るといろいろ面倒なことになっちゃった。</p>

<p>あと、これまでのSEOをゼロにしたくないからURLは変えたくなくて、やっぱりURLでは英語のタイトルを使いたい。
これはもうどうしょうもなくて、ファイル内に英語タイトルと日本語タイトルを設定出来るようにした。</p>

<p>ここは手作業でやったけど、多分シェルでもうまいことやれると思う。</p>

<h3 id="テーマが少ない:6a8fd8223fd13a59d819b0862af33f03">テーマが少ない</h3>

<p>まあこれから増えるでしょう。</p>

<p>ブログ自体に注力せずに記事を書くことに注力したい、って人はOctopressかHexoかそもそもHatenaとかの方がいいのかもしれない。</p>

<h2 id="移行において:6a8fd8223fd13a59d819b0862af33f03">移行において</h2>

<p>記事の移行と、なるべく移行前と移行後でブログを書く作業が変わらないように工夫した点をまとめる。</p>

<h3 id="日付フォーマットの変更:6a8fd8223fd13a59d819b0862af33f03">日付フォーマットの変更</h3>

<p>Octopressと違ってHugoでは日付のフォーマットを</p>

<pre><code>date: &quot;2013-10-27&quot;
</code></pre>

<p>こんな感じにしなきゃいけないので、先人の知恵を使って置換する。</p>

<pre><code class="language-sh">$ find . -type f -exec sed -i &quot;&quot; -e 's/\([0-9]\+-[0-9]\+-[0-9]\+\).*$/&quot;\1&quot;/' {} \;
</code></pre>

<h3 id="画像タグの変更:6a8fd8223fd13a59d819b0862af33f03">画像タグの変更</h3>

<p>Octopressではこう書いてたけど</p>

<pre><code class="language-markdown">[{% img /images/2015-01-01/beanstalkDockerApp.png 'beanstalkDockerApp' 'beanstalkDockerApp' %}](/images/2015-01-01/beanstalkDockerApp.png)
</code></pre>

<p>Hugoでは画像タグHTMLベタにするので、</p>

<pre><code class="language-sh">$ find . -type f -exec sed -i &quot;&quot; -e 's/{%.*img.*\/images\/\(.*\)\/\(.*\) \(.*\) .* %}/&lt;img src=\&quot;\/images\/\1\/\2&quot; class=\&quot;image\&quot; alt=\&quot;\3\&quot;&gt;/g' {} \;
</code></pre>

<p>と思ったら<code>alt</code>がおかしくなったので、</p>

<pre><code class="language-sh">$ find . -type f -exec sed -i &quot;&quot; -e 's/alt=\&quot;'\''\(.*\)'\''\&quot;/alt=\&quot;\1\&quot;/g' {} \;
</code></pre>

<p>sedでシングルクォート置換するのってちょっと面倒なんだね。</p>

<h2 id="デプロイと記事作成のシェル化:6a8fd8223fd13a59d819b0862af33f03">デプロイと記事作成のシェル化</h2>

<p>今回もGitHub Pagesで運用するけど、ブランチ構成は前と変わらず<code>master</code>と<code>source</code>でやりたいので、デプロイはシェルにまとめる。</p>

<pre><code class="language-sh">#!/bin/bash

echo -e &quot;\033[0;32mDeploying updates to GitHub...\033[0m&quot;

# Build the project. 
hugo -t flatten

# Add changes to git.
git add -A

# Commit changes.
msg=&quot;rebuilding site `date`&quot;
if [ $# -eq 1 ]
  then msg=&quot;$1&quot;
fi
git commit -m &quot;$msg&quot;

# Push source and build repos.
git push origin source
git subtree push --prefix=public origin master
</code></pre>

<p>記事のファイル名も日付付与を継続したいので、</p>

<pre><code class="language-sh">#!/bin/bash

title=`echo $1 | tr &quot;A-Z&quot; &quot;a-z&quot;`
title=`echo $title | tr &quot; &quot; &quot;-&quot;`
title=`echo $title | sed &quot;s/\.//g&quot;`
hugo new post/&quot;`date +%Y-%m-%d`-$title.markdown&quot;
</code></pre>

<p>こんな感じで。</p>

<p>ひと段落したけどまだまだ細々といじらなきゃだろうなあ。</p>

<h2 id="参考にさせて頂きました:6a8fd8223fd13a59d819b0862af33f03">参考にさせて頂きました</h2>

<p><a href="http://gohugo.io/tutorials/github_pages_blog/">Hosting on GitHub Pages</a></p>

<p><a href="http://nathanleclaire.com/blog/2014/12/22/migrating-to-hugo-from-octopress/">Migrating to Hugo From Octopress</a></p>
</div>

    <aside>

      <div class="section"><a href="http://yet.unresolved.xyz/tags/golang" class="tag">golang</a><a href="http://yet.unresolved.xyz/tags/octopress" class="tag">octopress</a><a href="http://yet.unresolved.xyz/tags/hugo" class="tag">hugo</a><a href="http://yet.unresolved.xyz/tags/ruby" class="tag">ruby</a></div>

      
      
      

    </aside>

  </article>

      </div>

    <div class="container-fluid">
      <footer class="site">
        <p>&copy; 2016 Daisuke Tsuji</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>,</p>
        <p>Theme <a href="https://github.com/dim0627/hugo_theme_aglaus" target="_blank">Aglaus</a> designed by <a href="http://yet.unresolved.xyz" target="_blank">Daisuke Tsuji</a></p>
      </footer>
    </div>

    <script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-55005303-1', 'auto');
    ga('send', 'pageview');
    </script>
    

  </body>
</html>

</div>
