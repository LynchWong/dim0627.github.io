<!DOCTYPE html>

<meta charset="utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">



<meta property="og:type" content="article">
<meta property="og:title" content="SlackAPIで遊ぶ | Unresolved">
<meta property="og:url" content="http://yet.unresolved.xyz/blog/2015/01/25/play-slack-api/">
<meta property="og:description" content="最近 ふつうのLinuxプログラミングを読んでます。知りたいことが書かれてて楽しい！ でもずっと本読むのは飽きるよね。なのでSlackのAPIとか触ってみる。 SlackAPIの種類 SlackのAPIはいくつか種類があるんだね、トリガになるパターンが違うのかな？ 2015年01月24日時点でのAPIをまとめてみる。 Slack Web API 指定したチャンネルの履歴とかユーザの一覧とか、Slackの情報を取得出来る。 Web APIなので、URLベースでの取得。 Real Time Messaging API Web Socketベースのリアルタイムチャット機能を提供する？ bot userがどうのこうのっていうのがよくわからない。 Slackbot Remote Control SlackBotに喋らせたり出来る。ちょうかわいい。 Incoming Webhooks 指定したチャンネルに投稿出来る。 Outgoing Webhooks 指定した単語に応じて指定したURLを叩ける。 Slash Commands 指定したスラッシュで始まる単語に応じてURLを叩けて、レスポンスがそのまま投稿される。 今回は発言のタイミングで発火するSlash Commandsを使ってみようかな！ スラッシュコマンドの追加 ここから新しくコマンドの追加が出来る。 https://my.slack.com/services/new/slash-commands herokuでさくっとHello World作って試してみようかな。 おお、出るじゃん！でもOnly you can see this messageって出てる、オレしか見れないんだね。 REPLを作ろう なんかSlack上でプログラム打つと実行結果が返ってくるみたいなやつ誰かが作ってたよね？ あれ調べても出ないんだけどなんでなんだろう。 まあとりあえず、作ったばっかのpaiza.IOのAPIを叩くあれを導入してみる。 paiza.ioのAPIを使ってreplを作る | Unresolved スラッシュコマンドAPIは/command argsって感じにやると、指定したURLにtextってパラメータ名でargsが飛ばされるみたい。 なので/repl ruby:p &quot;hello&quot;って感じで実行できるようにしようかな。 別にURL出してもいいんだけど・・・。 compojureのルーティングはこんな。 (defroutes app-routes (GET &quot;/&quot; [text] (if (empty? text) &quot;Invalid input.&quot;">

<meta property="og:image" content="http://yet.unresolved.xyz/images/slack.png">


<meta property="og:site_name" content="Unresolved">

<title>
    
    SlackAPIで遊ぶ | Unresolved
    
</title>


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_light.min.css">
<link rel="stylesheet" href="http://yet.unresolved.xyz/css/base.css">
<link rel="stylesheet" href="http://yet.unresolved.xyz/css/styles.css">
<link rel="stylesheet" href="http://yet.unresolved.xyz/css/custom.css">


<link rel="shortcut icon" href="http://yet.unresolved.xyz/assets/favicon.ico">


<link rel="alternate" type="application/rss+xml" title="RSS" href="http://yet.unresolved.xyz/index.xml">



<div class="wrap">
    <div class="masthead">
        <div class="container">
            <h3 class="masthead-title">
                <a href="http://yet.unresolved.xyz" title="Home">Unresolved</a>
            </h3>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </div>
    </div>

    <div class="container content">


<article class="post post-single">
    <span class="post-date">Sun, Jan 25, 2015</span>
    <h1 class="post-title">SlackAPIで遊ぶ</h1>

    <div class="eyecatch">
        
        <img src="http://yet.unresolved.xyz/images/slack.png" alt="SlackAPIで遊ぶ">
        
    </div>

    <div class="post-content">
        

<p>最近
<a href="http://www.amazon.co.jp/gp/product/4797328355/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797328355&linkCode=as2&tag=unresolved-22">ふつうのLinuxプログラミング</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=unresolved-22&l=as2&o=9&a=4797328355" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important; display:inline;" />を読んでます。知りたいことが書かれてて楽しい！</p>

<p>でもずっと本読むのは飽きるよね。なのでSlackのAPIとか触ってみる。</p>

<h2 id="slackapiの種類:4800906b877996c3dc902a23f48b0c5e">SlackAPIの種類</h2>

<p>SlackのAPIはいくつか種類があるんだね、トリガになるパターンが違うのかな？</p>

<p>2015年01月24日時点でのAPIをまとめてみる。</p>

<h3 id="slack-web-api-https-api-slack-com-web:4800906b877996c3dc902a23f48b0c5e"><a href="https://api.slack.com/web">Slack Web API</a></h3>

<p>指定したチャンネルの履歴とかユーザの一覧とか、Slackの情報を取得出来る。</p>

<p>Web APIなので、URLベースでの取得。</p>

<h3 id="real-time-messaging-api-https-api-slack-com-rtm:4800906b877996c3dc902a23f48b0c5e"><a href="https://api.slack.com/rtm">Real Time Messaging API</a></h3>

<p>Web Socketベースのリアルタイムチャット機能を提供する？</p>

<p>bot userがどうのこうのっていうのがよくわからない。</p>

<h3 id="slackbot-remote-control-https-api-slack-com-slackbot:4800906b877996c3dc902a23f48b0c5e"><a href="https://api.slack.com/slackbot">Slackbot Remote Control</a></h3>

<p>SlackBotに喋らせたり出来る。ちょうかわいい。</p>

<h3 id="incoming-webhooks-https-api-slack-com-incoming-webhooks:4800906b877996c3dc902a23f48b0c5e"><a href="https://api.slack.com/incoming-webhooks">Incoming Webhooks</a></h3>

<p>指定したチャンネルに投稿出来る。</p>

<h3 id="outgoing-webhooks-https-api-slack-com-outgoing-webhooks:4800906b877996c3dc902a23f48b0c5e"><a href="https://api.slack.com/outgoing-webhooks">Outgoing Webhooks</a></h3>

<p>指定した単語に応じて指定したURLを叩ける。</p>

<h3 id="slash-commands-https-api-slack-com-slash-commands:4800906b877996c3dc902a23f48b0c5e"><a href="https://api.slack.com/slash-commands">Slash Commands</a></h3>

<p>指定したスラッシュで始まる単語に応じてURLを叩けて、レスポンスがそのまま投稿される。</p>

<p>今回は発言のタイミングで発火する<a href="https://api.slack.com/slash-commands">Slash Commands</a>を使ってみようかな！</p>

<h2 id="スラッシュコマンドの追加:4800906b877996c3dc902a23f48b0c5e">スラッシュコマンドの追加</h2>

<p>ここから新しくコマンドの追加が出来る。</p>

<p><a href="https://my.slack.com/services/new/slash-commands">https://my.slack.com/services/new/slash-commands</a></p>

<p><a href="/images/2015-01-25/new_command.png"><img src="/images/2015-01-25/new_command.png" class="image" alt="new_command"></a></p>

<p>herokuでさくっとHello World作って試してみようかな。</p>

<p><a href="/images/2015-01-25/command_test.png"><img src="/images/2015-01-25/command_test.png" class="image" alt="command_test"></a></p>

<p>おお、出るじゃん！でも<code>Only you can see this message</code>って出てる、オレしか見れないんだね。</p>

<h2 id="replを作ろう:4800906b877996c3dc902a23f48b0c5e">REPLを作ろう</h2>

<p>なんかSlack上でプログラム打つと実行結果が返ってくるみたいなやつ誰かが作ってたよね？</p>

<p>あれ調べても出ないんだけどなんでなんだろう。</p>

<p>まあとりあえず、作ったばっかの<a href="https://paiza.io/">paiza.IO</a>のAPIを叩くあれを導入してみる。</p>

<p><a href="http://yet.unresolved.xyz/blog/2015/01/25/make-repl-using-the-paizaio/">paiza.ioのAPIを使ってreplを作る | Unresolved</a></p>

<p>スラッシュコマンドAPIは<code>/command args</code>って感じにやると、指定したURLに<code>text</code>ってパラメータ名で<code>args</code>が飛ばされるみたい。</p>

<p>なので<code>/repl ruby:p &quot;hello&quot;</code>って感じで実行できるようにしようかな。</p>

<p><a href="/images/2015-01-25/slack_repl.png"><img src="/images/2015-01-25/slack_repl.png" class="image" alt="slack_repl"></a></p>

<p>別にURL出してもいいんだけど・・・。</p>

<p><code>compojure</code>のルーティングはこんな。</p>

<pre><code class="language-clojure">(defroutes app-routes
  (GET &quot;/&quot; [text]
       (if (empty? text) &quot;Invalid input.&quot;
         (let [[language source] (seq (.split text &quot;:&quot;))]
           (str &quot;[&quot; language &quot;] &quot; source &quot;\r\n-&gt; &quot; (repl language source))))))
</code></pre>

<h2 id="実行してみる:4800906b877996c3dc902a23f48b0c5e">実行してみる</h2>

<p>さっき書いた通り、<code>/repl ruby:p &quot;hello&quot;</code>でいけるかな。</p>

<p><a href="/images/2015-01-25/slack_repl_run.png"><img src="/images/2015-01-25/slack_repl_run.png" class="image" alt="slack_repl_run"></a></p>

<p>いけるやん！</p>

<p>Javaだる！</p>

<h2 id="コード:4800906b877996c3dc902a23f48b0c5e">コード</h2>

<p>やばい<code>project.clj</code>とかherokuから持ってきたままだしリファクタリングもしてないし超適当だ</p>

<p><a href="https://github.com/dim0627/slack_repl">dim0627/slack_repl</a></p>

    </div>

    <aside class="post-ad pc">
        <iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=unresolved-22&o=9&p=48&l=st1&mode=books-jp&search=heroku&fc1=000000&lt1=_blank&lc1=000000&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="728" height="90" border="0" frameborder="0" style="border:none;" scrolling="no"></iframe>
    </aside>

    <aside class="post-ad sp">
<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=unresolved-22&o=9&p=12&l=st1&mode=books-jp&search=heroku&fc1=000000&lt1=_blank&lc1=000000&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="300" height="250" border="0" frameborder="0" style="border:none;" scrolling="no"></iframe>
    </aside>

    
    <aside class="post-related">
        
        <h3>Related Post</h3>

        
        <ul class="post-tags">
            
            <li>
                <a href="http://yet.unresolved.xyz/tags/heroku">
                    <i class="fa fa-tags"></i>
                    heroku
                </a>
            </li>
            
            <li>
                <a href="http://yet.unresolved.xyz/tags/slack">
                    <i class="fa fa-tags"></i>
                    slack
                </a>
            </li>
            
        </ul>

        <ul>
            
            
            
            
            
            
            
            
            
            
            <li><a href="http://yet.unresolved.xyz/blog/2015/01/25/make-repl-using-the-paizaio/">paiza.ioのAPIを使ってreplを作る</a></li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <li><a href="http://yet.unresolved.xyz/blog/2014/12/21/does-not-work-lobos-in-heroku/">Lobosでマイグレーションができない in Heroku</a></li>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        </ul>
    </aside>
    

    
    <footer>
        <div class="move">
            <div class="prev">
                
            </div>
            <div class="next">
                
                <a href="http://yet.unresolved.xyz/blog/2015/01/25/make-repl-using-the-paizaio/">
                    paiza.ioのAPIを使ってreplを作る
                    <i class="fa fa-chevron-right"></i>
                </a>
                
            </div>
        </div>

        
        
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
 
var disqus_shortname = 'unresolved'; 

 
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
        
    </footer>

</article>


    </div>
</div>

<div class="container footer-ad">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-4218045898905176"
         data-ad-slot="4750057642"
         data-ad-format="auto"></ins>
    <script>
(adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>


<aside class="sidebar-wrapper">
    <div class="container">
        
        <div class="tags tag-cloud">
            <h2>Tags</h2>
            <ul class="post-tags">
                
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/auriga">
                        auriga
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/aws">
                        aws
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/beanstalk">
                        beanstalk
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/boot2docker">
                        boot2docker
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/centos">
                        centos
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/clang">
                        clang
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/clojure">
                        clojure
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/css">
                        css
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/database">
                        database
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/design">
                        design
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/dns">
                        dns
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/docker">
                        docker
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/enlive">
                        enlive
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/git">
                        git
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/github">
                        github
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/golang">
                        golang
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/google-app-engine">
                        google-app-engine
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/gravatar">
                        gravatar
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/hackathon">
                        hackathon
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/heroku">
                        heroku
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/hiccup">
                        hiccup
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/html">
                        html
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/hugo">
                        hugo
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/javascript">
                        javascript
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/jekyll">
                        jekyll
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/laravel">
                        laravel
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/leiningen">
                        leiningen
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/linux">
                        linux
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/lobos">
                        lobos
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/migration">
                        migration
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/node.js">
                        node.js
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/octopress">
                        octopress
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/paiza">
                        paiza
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/paizaio">
                        paizaio
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/php">
                        php
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/postgres">
                        postgres
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/postgresql">
                        postgresql
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/python">
                        python
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/ruby">
                        ruby
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/sass">
                        sass
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/scss">
                        scss
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/slack">
                        slack
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/sql-server">
                        sql-server
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/sqlite">
                        sqlite
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/startup">
                        startup
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/startup-weekend">
                        startup-weekend
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/ubuntu">
                        ubuntu
                    </a>
                </li>
                
                <li>
                    
                    <a href="http://yet.unresolved.xyz/tags/vagrant">
                        vagrant
                    </a>
                </li>
                
            </ul>
        </div>
        
        
        <div id="profile">
            <div class="eyecatch">
                <img id="photo" src="/images/nopicture.png" alt="profile">
            </div>
            <div class="data">
                
                <span class="post-date">Sun, Feb 26, 1989</span>
                
                <h1 id="username" class="post-title"></h1>
                
                <a href="https://www.facebook.com/daisuke.tsuji.735" target="_blank"><i class="fa fa-facebook-square"></i></a>
                
                
                <a href="https://twitter.com/dim0627" target="_blank"><i class="fa fa-twitter-square"></i></a>
                
                
                <a href="https://github.com/dim0627" target="_blank"><i class="fa fa-github-square"></i></a>
                
                <pre id="description"></pre>
                <ul id="urls" class="post-tags"></ul>
            </div>
        </div>
        
    </div>
</aside>



<footer class="copy">
    <p>&copy; 2015  Daisuke Tsuji </p>
    <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>, Theme <a href="https://github.com/dim0627/hugo_theme_aglaus" target="_blank">Aglaus</a> designed by <a href="http://yet.unresolved.xyz" target="_blank">Daisuke Tsuji</a></p>
</footer>

<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script src="http://yet.unresolved.xyz/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-55005303-1', 'auto');
ga('send', 'pageview');

</script>

<script>
$(function() {
    var url = "https://ja.gravatar.com/1e092e9f2cda827deb8623be2e846936.json?callback=?";
    $.getJSON(url)
        .done(function(data) {
            var entry = data.entry[0];
            $("#photo").attr("src", entry.photos[0].value);
            $("#username").html(entry.name.familyName + " " + entry.name.givenName);
            $("#description").html(entry.aboutMe);
            entry.urls.forEach(function(el){
                $("#urls").append($("<li><a href='" + el.value + "'>" + el.title + "</a></li>"));
            });
            $("#profile").show();
        });
});
</script>

<script>
document.write('<script src="//sharebutton.net/plugin/sharebutton.php?type=horizontal&u=' + encodeURIComponent(document.location.href) + '"></scr' + 'ipt>');
</script>

